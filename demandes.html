<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Demandes Étudiant</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Sora:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style/demandes.css" />
    <style>
      /* Additional styles for offline mode */
      .status-offline {
        background-color: #6c757d;
        color: white;
      }

      .alert-warning {
        background-color: #fff3cd;
        color: #856404;
        border: 1px solid #ffeeba;
        border-radius: 4px;
        padding: 10px;
        margin-bottom: 15px;
      }
    </style>
  </head>
  <body>
    <div class="dashboard-container">
      <!-- Sidebar -->
      <div id="navbar-container"></div>

      <!-- Main Content -->
      <div class="main-content">
        <div class="header">
          <h1 class="page-title">Mes Demandes</h1>
          <div class="header-actions">
            <button id="new-request-btn">Nouvelle Demande</button>
          </div>
        </div>

        <!-- Contenu principal -->
        <div class="tab-container">
          <div class="tab-buttons">
            <button
              class="tab-button active"
              onclick="openTab(event, 'formulaires')"
            >
              Formulaires de demande
            </button>
            <button class="tab-button" onclick="openTab(event, 'suivi')">
              Suivi des demandes
            </button>
          </div>

          <!-- Onglet Formulaires -->
          <div id="formulaires" class="tab-content active">
            <div class="alert alert-info">
              Veuillez remplir le formulaire correspondant à votre type de
              demande. Une fois soumise, vous pourrez suivre l'état de votre
              demande dans l'onglet "Suivi des demandes".
            </div>

            <!-- Sous-onglets pour les différents formulaires -->
            <div class="tab-buttons">
              <button
                class="tab-button active"
                onclick="openSubTab(event, 'section-form')"
              >
                Changement de Section
              </button>
              <button class="tab-button" onclick="openSubTab(event, 'td-form')">
                Changement de Groupe TD
              </button>
              <button class="tab-button" onclick="openSubTab(event, 'tp-form')">
                Changement de Groupe TP
              </button>
            </div>

            <!-- Formulaire de changement de section -->
            <div id="section-form" class="tab-content active form-card">
              <h2 class="card-title">
                Formulaire de demande de changement de section
              </h2>
              <form id="section-change-form">
                <div class="form-group">
                  <label for="current-section">Section actuelle</label>
                  <input type="text" id="current-section" value="" readonly />
                </div>

                <div class="form-group">
                  <label for="requested-section">Section demandée</label>
                  <select id="requested-section" required>
                    <option value="">Sélectionnez une section</option>
                    <!-- Options loaded dynamically -->
                  </select>
                </div>

                <div class="form-group">
                  <label for="section-reason">Motif de la demande</label>
                  <select id="section-reason" required>
                    <option value="">Sélectionnez un motif</option>
                    <option value="SCHEDULE_CONFLICT">Conflit d'horaire</option>
                    <option value="MEDICAL">Raison médicale</option>
                    <option value="TRANSPORT">Problème de transport</option>
                    <option value="OTHER">Autre</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="section-justification"
                    >Justification détaillée</label
                  >
                  <textarea
                    id="section-justification"
                    placeholder="Veuillez expliquer en détail les raisons de votre demande..."
                    required
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="section-document"
                    >Document justificatif (PDF, JPG, PNG)</label
                  >
                  <input
                    type="file"
                    id="section-document"
                    accept=".pdf,.jpg,.jpeg,.png"
                  />
                </div>

                <div
                  class="error-message"
                  id="section-form-error"
                  style="display: none; color: red; margin: 10px 0"
                ></div>
                <div
                  class="success-message"
                  id="section-form-success"
                  style="display: none; color: green; margin: 10px 0"
                ></div>

                <button
                  type="button"
                  class="submit-btn"
                  onclick="submitRequest('SECTION_CHANGE', 'section')"
                >
                  Soumettre la demande
                </button>
              </form>
            </div>

            <!-- Formulaire de changement de groupe TD -->
            <div id="td-form" class="tab-content form-card">
              <h2 class="card-title">
                Formulaire de demande de changement de groupe TD
              </h2>
              <form id="td-change-form">
                <div class="form-group">
                  <label for="current-td">Groupe TD actuel</label>
                  <input type="text" id="current-td" value="" readonly />
                </div>

                <div class="form-group">
                  <label for="requested-td">Groupe TD demandé</label>
                  <select id="requested-td" required>
                    <option value="">Sélectionnez un groupe</option>
                    <!-- Options loaded dynamically -->
                  </select>
                </div>

                <div class="form-group">
                  <label for="td-reason">Motif de la demande</label>
                  <select id="td-reason" required>
                    <option value="">Sélectionnez un motif</option>
                    <option value="SCHEDULE_CONFLICT">Conflit d'horaire</option>
                    <option value="GROUP_WORK">Travail en groupe</option>
                    <option value="TRANSPORT">Problème de transport</option>
                    <option value="OTHER">Autre</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="td-justification">Justification détaillée</label>
                  <textarea
                    id="td-justification"
                    placeholder="Veuillez expliquer en détail les raisons de votre demande..."
                    required
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="td-document"
                    >Document justificatif (PDF, JPG, PNG)</label
                  >
                  <input
                    type="file"
                    id="td-document"
                    accept=".pdf,.jpg,.jpeg,.png"
                  />
                </div>

                <div
                  class="error-message"
                  id="td-form-error"
                  style="display: none; color: red; margin: 10px 0"
                ></div>
                <div
                  class="success-message"
                  id="td-form-success"
                  style="display: none; color: green; margin: 10px 0"
                ></div>

                <button
                  type="button"
                  class="submit-btn"
                  onclick="submitRequest('TD_GROUP_CHANGE', 'td')"
                >
                  Soumettre la demande
                </button>
              </form>
            </div>

            <!-- Formulaire de changement de groupe TP -->
            <div id="tp-form" class="tab-content form-card">
              <h2 class="card-title">
                Formulaire de demande de changement de groupe TP
              </h2>
              <form id="tp-change-form">
                <div class="form-group">
                  <label for="current-tp">Groupe TP actuel</label>
                  <input type="text" id="current-tp" value="" readonly />
                </div>

                <div class="form-group">
                  <label for="requested-tp">Groupe TP demandé</label>
                  <select id="requested-tp" required>
                    <option value="">Sélectionnez un groupe</option>
                    <!-- Options loaded dynamically -->
                  </select>
                </div>

                <div class="form-group">
                  <label for="tp-reason">Motif de la demande</label>
                  <select id="tp-reason" required>
                    <option value="">Sélectionnez un motif</option>
                    <option value="SCHEDULE_CONFLICT">Conflit d'horaire</option>
                    <option value="GROUP_WORK">Binôme/groupe de projet</option>
                    <option value="EQUIPMENT">Accès au matériel</option>
                    <option value="OTHER">Autre</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="tp-justification">Justification détaillée</label>
                  <textarea
                    id="tp-justification"
                    placeholder="Veuillez expliquer en détail les raisons de votre demande..."
                    required
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="tp-document"
                    >Document justificatif (PDF, JPG, PNG)</label
                  >
                  <input
                    type="file"
                    id="tp-document"
                    accept=".pdf,.jpg,.jpeg,.png"
                  />
                </div>

                <div
                  class="error-message"
                  id="tp-form-error"
                  style="display: none; color: red; margin: 10px 0"
                ></div>
                <div
                  class="success-message"
                  id="tp-form-success"
                  style="display: none; color: green; margin: 10px 0"
                ></div>

                <button
                  type="button"
                  class="submit-btn"
                  onclick="submitRequest('TP_GROUP_CHANGE', 'tp')"
                >
                  Soumettre la demande
                </button>
              </form>
            </div>
          </div>

          <!-- Onglet Suivi des demandes -->
          <div id="suivi" class="tab-content">
            <div class="form-card">
              <h2 class="card-title">Suivi de mes demandes</h2>

              <div id="requests-loading" class="loading-indicator">
                Chargement des demandes...
              </div>
              <div
                id="requests-error"
                class="error-message"
                style="display: none"
              ></div>

              <table class="requests-table" id="requests-table">
                <thead>
                  <tr>
                    <th>Type de demande</th>
                    <th>Date de soumission</th>
                    <th>Changement demandé</th>
                    <th>Statut</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="requests-table-body">
                  <!-- Requests will be loaded dynamically -->
                </tbody>
              </table>

              <div
                id="no-requests-message"
                class="empty-state"
                style="display: none"
              >
                Vous n'avez pas encore soumis de demandes.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="demandes.js"></script>
  </body>
</html>
