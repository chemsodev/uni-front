<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Chef de Spécialité - Gestion</title>
    <link href="style/chef-de-specialite.css" rel="stylesheet">
  
</head>
<body>
    <div class="dashboard-container">
        <div class="sidebar" id="sidebar">
            <div class="logo-container">
                <div class="logo">Chef de Spécialité</div>
            </div>
            
            <div class="user-info">
                <div class="user-name">Dr. Ahmed Benali</div>
                <div class="user-role">Chef de Spécialité - Informatique</div>
            </div>
            
            <div class="menu-title">Navigation</div>
            <ul class="menu">
                <li class="menu-item active" onclick="changeTab('gestion')">
                    <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    Tableau de Bord
                </li>
                <li class="menu-item" onclick="changeTab('etudiants')">
                    <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    Liste des Étudiants
                </li>
                <li class="menu-item" onclick="changeTab('demandes')">
                    <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    Validation des Demandes
                </li>
                <li class="menu-item">
                    <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                    Paramètres
                </li>
            </ul>
            
            <div class="logout">
                <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
                Déconnexion
            </div>
        </div>
        
        <div class="main-content">
            <div class="dashboard-header">
                <div>
                    <h1 class="welcome-text">Bonjour, Dr. Benali</h1>
                    <p class="dashboard-date" id="current-date">Dimanche 13 avril 2025</p>
                </div>
            </div>
            
            <!-- Tab 1: Gestion de la Spécialité -->
            <div class="tab-content active" id="gestion-content">
                <div class="cards-container">
                    <div class="card">
                        <div class="card-title">
                            <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                            </svg>
                            Étudiants
                        </div>
                        <div class="card-value" id="total-etudiants">87</div>
                        <div class="card-label">Total d'étudiants inscrits</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">
                            <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                <polyline points="22 4 12 14.01 9 11.01"></polyline>
                            </svg>
                            Sections
                        </div>
                        <div class="card-value" id="total-sections">3</div>
                        <div class="card-label">Nombre de sections</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">
                            <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            Demandes
                        </div>
                        <div class="card-value" id="total-demandes">4</div>
                        <div class="card-label">Demandes en attente</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">
                            <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M12 20v-6M6 20V10M18 20V4"></path>
                            </svg>
                            Moyenne
                        </div>
                        <div class="card-value" id="moyenne-specialite">13.25</div>
                        <div class="card-label">Moyenne de la spécialité</div>
                    </div>
                </div>
                
                <div class="chart-row">
                    <div class="chart-container">
                        <h3 class="chart-title">Répartition par section</h3>
                        <div class="chart" id="chart-repartition" style="height: 250px; background-color: rgba(226, 232, 240, 0.3); border-radius: 10px; display: flex; justify-content: space-around; align-items: flex-end; padding: 1rem;">
                            <!-- Le contenu sera généré dynamiquement -->
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <h3 class="chart-title">Performance par section</h3>
                        <div class="chart" id="chart-performance" style="height: 250px; background-color: rgba(226, 232, 240, 0.3); border-radius: 10px; padding: 1rem;">
                            <!-- Le contenu sera généré dynamiquement -->
                        </div>
                    </div>
                </div>
                
                <div class="content-section">
                    <h2 class="section-title">Derniers modules ajoutés</h2>
                    <div class="search-filter-bar">
                        <input type="text" class="search-input" placeholder="Rechercher un module...">
                        <select class="filter-select">
                            <option value="">Tous les semestres</option>
                            <option value="S1">Semestre 1</option>
                            <option value="S2">Semestre 2</option>
                        </select>
                        <button class="search-btn">Rechercher</button>
                        <button class="action-btn success" onclick="openModal('module-modal')">Ajouter un module</button>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Code Module</th>
                                <th>Nom du Module</th>
                                <th>Crédits</th>
                                <th>Enseignant</th>
                                <th>Semestre</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="modules-table-body">
                            <!-- Le contenu sera généré dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Tab 2: Liste des Étudiants -->
            <div class="tab-content" id="etudiants-content">
                <div class="content-section">
                    <h2 class="section-title">Liste des Étudiants</h2>
                    <div class="search-filter-bar">
                        <input type="text" class="search-input" placeholder="Rechercher un étudiant...">
                        <select class="filter-select">
                            <option value="">Toutes les sections</option>
                            <option value="A">Section A</option>
                            <option value="B">Section B</option>
                            <option value="C">Section C</option>
                        </select>
                        <button class="search-btn">Rechercher</button>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Matricule</th>
                                <th>Nom & Prénom</th>
                                <th>Section</th>
                                <th>Email</th>
                                <th>Moyenne</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="etudiants-table-body">
                            <!-- Le contenu sera généré dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Tab 3: Validation des Demandes -->
            <div class="tab-content" id="demandes-content">
                <div class="content-section">
                    <h2 class="section-title">Demandes en attente</h2>
                    <div class="search-filter-bar">
                        <input type="text" class="search-input" placeholder="Rechercher une demande...">
                        <select class="filter-select">
                            <option value="">Tous les types</option>
                            <option value="changement">Changement de section</option>
                            <option value="absence">Justification d'absence</option>
                            <option value="stage">Demande de stage</option>
                        </select>
                        <button class="search-btn">Rechercher</button>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Étudiant</th>
                                <th>Type</th>
                                <th>Date</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="demandes-en-attente-table-body">
                            <!-- Le contenu sera généré dynamiquement -->
                        </tbody>
                    </table>
                </div>
                
                <div class="content-section">
                    <h2 class="section-title">Historique des demandes</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Étudiant</th>
                                <th>Type</th>
                                <th>Date</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="historique-demandes-table-body">
                            <!-- Le contenu sera généré dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal for Adding/Editing Module -->
    <div class="modal-backdrop" id="module-modal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Ajouter un Module</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="module-form">
                <div class="form-group">
                    <label class="form-label">Code du Module</label>
                    <input type="text" class="form-input" id="module-code" placeholder="Ex: INF101">
                </div>
                <div class="form-group">
                    <label class="form-label">Nom du Module</label>
                    <input type="text" class="form-input" id="module-nom" placeholder="Nom complet du module">
                </div>
                <div class="form-group">
                    <label class="form-label">Crédits</label>
                    <input type="number" class="form-input" id="module-credits" min="1" max="6">
                </div>
                <div class="form-group">
                    <label class="form-label">Enseignant</label>
                    <select class="form-select" id="module-enseignant">
                        <option value="">Sélectionner un enseignant</option>
                        <!-- Les options seront générées dynamiquement -->
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Semestre</label>
                    <select class="form-select" id="module-semestre">
                        <option value="">Sélectionner un semestre</option>
                        <option value="S1">Semestre 1</option>
                        <option value="S2">Semestre 2</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="module-description" placeholder="Description du module..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="action-btn secondary" onclick="closeModal('module-modal')">Annuler</button>
                    <button type="submit" class="action-btn">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Mobile Menu Toggle -->
    <div class="mobile-menu-toggle" id="mobile-menu-toggle">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
    </div>
    
    <script>
        // Données d'exemple pour les statistiques
        const statistiques = {
            totalEtudiants: 87,
            totalSections: 3,
            totalDemandes: 4,
            moyenneSpecialite: 13.25
        };

        // Données d'exemple pour les sections
        const sectionsData = [
            { nom: "Section A", etudiants: 32, moyenne: 12.75, pourcentage: 65 },
            { nom: "Section B", etudiants: 39, moyenne: 14.50, pourcentage: 85 },
            { nom: "Section C", etudiants: 16, moyenne: 11.85, pourcentage: 55 }
        ];

        // Données d'exemple pour les modules
        const modulesData = [
            { code: "INF102", nom: "Algorithmes et Structures de Données", credits: 4, enseignant: "Dr. Karim Belhadj", semestre: "S1" },
            { code: "INF103", nom: "Base de Données Avancées", credits: 3, enseignant: "Dr. Souad Meziane", semestre: "S1" },
            { code: "INF205", nom: "Architecture des Systèmes", credits: 4, enseignant: "Prof. Mohammed Rahmani", semestre: "S2" },
            { code: "INF208", nom: "Intelligence Artificielle", credits: 5, enseignant: "Dr. Leila Boudjema", semestre: "S2" },
            { code: "INF210", nom: "Développement Web", credits: 3, enseignant: "Dr. Karim Belhadj", semestre: "S2" },
            { code: "INF215", nom: "Sécurité Informatique", credits: 4, enseignant: "Prof. Mohammed Rahmani", semestre: "S2" }
        ];

        // Données d'exemple pour les enseignants
        const enseignantsData = [
            { id: 1, nom: "Dr. Karim Belhadj" },
            { id: 2, nom: "Dr. Souad Meziane" },
            { id: 3, nom: "Prof. Mohammed Rahmani" },
            { id: 4, nom: "Dr. Leila Boudjema" },
            { id: 5, nom: "Dr. Nadia Hamidi" }
        ];

        // Données d'exemple pour les étudiants
        const etudiantsData = [
            { matricule: "202310045", nom: "Amina Khelifi", section: "Section A", email: "a.khelifi@univ.dz", moyenne: 14.75 },
            { matricule: "202310078", nom: "Karim Ferhat", section: "Section B", email: "k.ferhat@univ.dz", moyenne: 12.25 },
            { matricule: "202310103", nom: "Sofia Mebarki", section: "Section A", email: "s.mebarki@univ.dz", moyenne: 15.50 },
            { matricule: "202310155", nom: "Yacine Hamdi", section: "Section C", email: "y.hamdi@univ.dz", moyenne: 11.00 },
            { matricule: "202310198", nom: "Meriem Benali", section: "Section B", email: "m.benali@univ.dz", moyenne: 16.25 },
            { matricule: "202310201", nom: "Ahmed Bouaziz", section: "Section A", email: "a.bouaziz@univ.dz", moyenne: 13.80 },
            { matricule: "202310215", nom: "Leila Mansouri", section: "Section B", email: "l.mansouri@univ.dz", moyenne: 15.10 },
            { matricule: "202310230", nom: "Samir Daoudi", section: "Section C", email: "s.daoudi@univ.dz", moyenne: 10.75 }
        ];

        // Données d'exemple pour les demandes
        const demandesData = [
            { id: "DEM-2025-045", etudiant: "Karim Ferhat", type: "Changement de section", date: "10/04/2025", statut: "pending" },
            { id: "DEM-2025-046", etudiant: "Sofia Mebarki", type: "Justification d'absence", date: "11/04/2025", statut: "pending" },
            { id: "DEM-2025-047", etudiant: "Meriem Benali", type: "Demande de stage", date: "12/04/2025", statut: "pending" },
            { id: "DEM-2025-048", etudiant: "Yacine Hamdi", type: "Changement de section", date: "13/04/2025", statut: "pending" },
            { id: "DEM-2025-040", etudiant: "Amina Khelifi", type: "Justification d'absence", date: "05/04/2025", statut: "approved" },
            { id: "DEM-2025-041", etudiant: "Mohamed Ouali", type: "Changement de section", date: "06/04/2025", statut: "denied" },
            { id: "DEM-2025-042", etudiant: "Nassima Khalfi", type: "Demande de stage", date: "07/04/2025", statut: "approved" },
            { id: "DEM-2025-043", etudiant: "Ahmed Bouaziz", type: "Justification d'absence", date: "08/04/2025", statut: "approved" },
            { id: "DEM-2025-044", etudiant: "Leila Mansouri", type: "Demande de stage", date: "09/04/2025", statut: "denied" }
        ];

        // Fonction pour charger les données
        function loadData() {
            // Mettre à jour les statistiques
            document.getElementById('total-etudiants').textContent = statistiques.totalEtudiants;
            document.getElementById('total-sections').textContent = statistiques.totalSections;
            document.getElementById('total-demandes').textContent = statistiques.totalDemandes;
            document.getElementById('moyenne-specialite').textContent = statistiques.moyenneSpecialite;

            // Générer le graphique de répartition par section
            const chartRepartition = document.getElementById('chart-repartition');
            chartRepartition.innerHTML = '';
            sectionsData.forEach(section => {
                const height = (section.etudiants / Math.max(...sectionsData.map(s => s.etudiants))) * 180;
                const sectionDiv = document.createElement('div');
                sectionDiv.style.display = 'flex';
                sectionDiv.style.flexDirection = 'column';
                sectionDiv.style.alignItems = 'center';
                sectionDiv.innerHTML = `
                    <div style="width: 60px; height: ${height}px; background: linear-gradient(to top, var(--primary-color), var(--secondary-color)); border-radius: 5px;"></div>
                    <div style="margin-top: 10px; font-size: 0.85rem;">${section.nom}</div>
                    <div style="font-size: 0.75rem; color: var(--gray-color);">${section.etudiants} étudiants</div>
                `;
                chartRepartition.appendChild(sectionDiv);
            });

            // Générer le graphique de performance par section
            const chartPerformance = document.getElementById('chart-performance');
            chartPerformance.innerHTML = '';
            sectionsData.forEach(section => {
                const sectionDiv = document.createElement('div');
                sectionDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                        <div style="font-size: 0.85rem;">${section.nom}</div>
                        <div style="font-size: 0.85rem; font-weight: 600;">${section.moyenne}</div>
                    </div>
                    <div style="width: 100%; height: 10px; background-color: rgba(255, 255, 255, 0.5); border-radius: 5px; margin-bottom: 1.5rem;">
                        <div style="width: ${section.pourcentage}%; height: 100%; background: linear-gradient(to right, var(--primary-color), var(--secondary-color)); border-radius: 5px;"></div>
                    </div>
                `;
                chartPerformance.appendChild(sectionDiv);
            });

            // Charger les modules
            const modulesTableBody = document.getElementById('modules-table-body');
            modulesTableBody.innerHTML = '';
            modulesData.forEach(module => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${module.code}</td>
                    <td>${module.nom}</td>
                    <td>${module.credits}</td>
                    <td>${module.enseignant}</td>
                    <td>${module.semestre}</td>
                    <td>
                        <button class="action-btn" onclick="editModule('${module.code}')">Modifier</button>
                        <button class="action-btn danger" onclick="deleteModule('${module.code}')">Supprimer</button>
                    </td>
                `;
                modulesTableBody.appendChild(row);
            });

            // Charger les étudiants
            const etudiantsTableBody = document.getElementById('etudiants-table-body');
            etudiantsTableBody.innerHTML = '';
            etudiantsData.forEach(etudiant => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${etudiant.matricule}</td>
                    <td>${etudiant.nom}</td>
                    <td>${etudiant.section}</td>
                    <td>${etudiant.email}</td>
                    <td>${etudiant.moyenne}</td>
                    <td>
                        <button class="action-btn" onclick="viewEtudiantDetails('${etudiant.matricule}')">Détails</button>
                        <button class="action-btn secondary" onclick="viewEtudiantNotes('${etudiant.matricule}')">Notes</button>
                    </td>
                `;
                etudiantsTableBody.appendChild(row);
            });

            // Charger les demandes en attente
            const demandesEnAttenteTableBody = document.getElementById('demandes-en-attente-table-body');
            demandesEnAttenteTableBody.innerHTML = '';
            const demandesEnAttente = demandesData.filter(demande => demande.statut === 'pending');
            demandesEnAttente.forEach(demande => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${demande.id}</td>
                    <td>${demande.etudiant}</td>
                    <td>${demande.type}</td>
                    <td>${demande.date}</td>
                    <td><span class="status status-pending">En attente</span></td>
                    <td>
                        <button class="action-btn" onclick="viewDemandeDetails('${demande.id}')">Détails</button>
                        <button class="action-btn success" onclick="approveDemande('${demande.id}')">Approuver</button>
                        <button class="action-btn danger" onclick="rejectDemande('${demande.id}')">Rejeter</button>
                    </td>
                `;
                demandesEnAttenteTableBody.appendChild(row);
            });

            // Charger l'historique des demandes
            const historiqueDemandesTableBody = document.getElementById('historique-demandes-table-body');
            historiqueDemandesTableBody.innerHTML = '';
            const demandesHistorique = demandesData.filter(demande => demande.statut !== 'pending');
            demandesHistorique.forEach(demande => {
                const row = document.createElement('tr');
                let statutClass = '';
                let statutText = '';
                
                if (demande.statut === 'approved') {
                    statutClass = 'status-approved';
                    statutText = 'Approuvée';
                } else if (demande.statut === 'denied') {
                    statutClass = 'status-denied';
                    statutText = 'Rejetée';
                }
                
                row.innerHTML = `
                    <td>${demande.id}</td>
                    <td>${demande.etudiant}</td>
                    <td>${demande.type}</td>
                    <td>${demande.date}</td>
                    <td><span class="status ${statutClass}">${statutText}</span></td>
                    <td>
                        <button class="action-btn" onclick="viewDemandeDetails('${demande.id}')">Détails</button>
                    </td>
                `;
                historiqueDemandesTableBody.appendChild(row);
            });

            // Charger les enseignants dans le formulaire de module
            const moduleEnseignantSelect = document.getElementById('module-enseignant');
            moduleEnseignantSelect.innerHTML = '<option value="">Sélectionner un enseignant</option>';
            enseignantsData.forEach(enseignant => {
                const option = document.createElement('option');
                option.value = enseignant.id;
                option.textContent = enseignant.nom;
                moduleEnseignantSelect.appendChild(option);
            });
        }

        // Fonction pour modifier un module
        function editModule(code) {
            const module = modulesData.find(m => m.code === code);
            if (module) {
                document.getElementById('module-code').value = module.code;
                document.getElementById('module-nom').value = module.nom;
                document.getElementById('module-credits').value = module.credits;
                
                // Trouver l'ID de l'enseignant
                const enseignant = enseignantsData.find(e => e.nom === module.enseignant);
                if (enseignant) {
                    document.getElementById('module-enseignant').value = enseignant.id;
                }
                
                document.getElementById('module-semestre').value = module.semestre;
                document.getElementById('module-description').value = `Description du module ${module.nom}`;
                
                document.querySelector('#module-modal .modal-title').textContent = 'Modifier un Module';
                openModal('module-modal');
            }
        }

        // Fonction pour supprimer un module
        function deleteModule(code) {
            if (confirm(`Êtes-vous sûr de vouloir supprimer le module ${code} ?`)) {
                const index = modulesData.findIndex(m => m.code === code);
                if (index !== -1) {
                    modulesData.splice(index, 1);
                    loadData();
                }
            }
        }

        // Fonction pour voir les détails d'un étudiant
        function viewEtudiantDetails(matricule) {
            const etudiant = etudiantsData.find(e => e.matricule === matricule);
            if (etudiant) {
                alert(`Détails de l'étudiant ${etudiant.nom} (${matricule})`);
            }
        }

        // Fonction pour voir les notes d'un étudiant
        function viewEtudiantNotes(matricule) {
            const etudiant = etudiantsData.find(e => e.matricule === matricule);
            if (etudiant) {
                alert(`Notes de l'étudiant ${etudiant.nom} (${matricule})`);
            }
        }

        // Fonction pour voir les détails d'une demande
        function viewDemandeDetails(id) {
            const demande = demandesData.find(d => d.id === id);
            if (demande) {
                alert(`Détails de la demande ${id} - ${demande.type} par ${demande.etudiant}`);
            }
        }

        // Fonction pour approuver une demande
        function approveDemande(id) {
            const index = demandesData.findIndex(d => d.id === id);
            if (index !== -1) {
                demandesData[index].statut = 'approved';
                statistiques.totalDemandes--;
                loadData();
            }
        }

        // Fonction pour rejeter une demande
        function rejectDemande(id) {
            const index = demandesData.findIndex(d => d.id === id);
            if (index !== -1) {
                demandesData[index].statut = 'denied';
                statistiques.totalDemandes--;
                loadData();
            }
        }

        // Function to change tab
        function changeTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.getElementById(tabId + '-content').classList.add('active');
            document.querySelector(`[onclick="changeTab('${tabId}')"]`).classList.add('active');
        }
        
        // Function to open modal
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        // Function to close modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Mobile menu toggle
        document.getElementById('mobile-menu-toggle').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('active');
        });
        
        // Modal close button
        document.querySelectorAll('.modal-close').forEach(button => {
            button.addEventListener('click', function() {
                this.closest('.modal-backdrop').style.display = 'none';
            });
        });
        
        // Formulaire de module
        document.getElementById('module-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const code = document.getElementById('module-code').value;
            const nom = document.getElementById('module-nom').value;
            const credits = document.getElementById('module-credits').value;
            const enseignantId = document.getElementById('module-enseignant').value;
            const semestre = document.getElementById('module-semestre').value;
            
            if (!code || !nom || !credits || !enseignantId || !semestre) {
                alert('Veuillez remplir tous les champs obligatoires');
                return;
            }
            
            const enseignant = enseignantsData.find(e => e.id == enseignantId);
            
            // Vérifier si c'est une modification ou un ajout
            const existingIndex = modulesData.findIndex(m => m.code === code);
            if (existingIndex !== -1) {
                // Modification
                modulesData[existingIndex] = {
                    code,
                    nom,
                    credits: parseInt(credits),
                    enseignant: enseignant.nom,
                    semestre
                };
            } else {
                // Ajout
                modulesData.push({
                    code,
                    nom,
                    credits: parseInt(credits),
                    enseignant: enseignant.nom,
                    semestre
                });
            }
            
            loadData();
            closeModal('module-modal');
            
            // Réinitialiser le formulaire
            this.reset();
            document.querySelector('#module-modal .modal-title').textContent = 'Ajouter un Module';
        });
        
        // Initialiser la date actuelle
        document.addEventListener('DOMContentLoaded', function() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const today = new Date();
            document.getElementById('current-date').textContent = today.toLocaleDateString('fr-FR', options);
            
            // Charger les données
            loadData();
        });
         
        document.addEventListener('DOMContentLoaded', function() {
            const REQUIRED_ROLE = 'chef-de-departement'; // Hardcoded role
            const token = sessionStorage.getItem('admin_token') || localStorage.getItem('admin_token');
            
            if (!token) {
                window.location.href = `admin-login.html?requestedRole=${REQUIRED_ROLE}`;
                return;
            }
        
            fetch('http://localhost:3000/api/auth/verify', {
                method: 'GET',
                headers: { 
                  'Authorization': `Bearer ${token}`,
                  'Content-Type': 'application/json'
                },
                mode: 'cors',
                credentials: 'include'
              })
            .then(response => {
                if (!response.ok) throw new Error('Invalid token');
                return response.json();
            })
            .then(data => {
                if (data.userType !== REQUIRED_ROLE) {
                    throw new Error('Role mismatch');
                }
                // Load protected content here
            })
            .catch(error => {
                console.error('Access denied:', error);
                sessionStorage.clear();
                localStorage.clear();
                window.location.href = `admin-login.html?requestedRole=${REQUIRED_ROLE}`;
            });
        })
        
    </script>
</body>
</html>