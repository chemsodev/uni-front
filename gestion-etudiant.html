<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Gestion des √âtudiants - Dashboard Enseignant</title>
    <link href="style/gestion-etudiant.css" rel="stylesheet">
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div id="navbar-container"></div>
        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1 class="page-title">Gestion des √âtudiants</h1>
            </div>
            
            <div class="student-management">
                <!-- Left Column - Student List -->
                <div class="left-column">
                    <div class="card">
                        <h2 class="card-title">Liste des √âtudiants</h2>
                        
                        <div class="search-section">
                            <div class="search-box">
                                <input type="text" id="student-search" placeholder="Rechercher un √©tudiant...">
                                <button onclick="filterStudents()">üîç</button>
                            </div>
                            
                            <select class="section-selector" id="section-filter" onchange="filterStudents()">
                                <option value="">Toutes les sections</option>
                                <option value="info-a">Informatique - Section A</option>
                                <option value="info-b">Informatique - Section B</option>
                                <option value="math-c">Math√©matiques - Section C</option>
                            </select>
                        </div>
                        
                        <div class="student-list" id="student-list-container">
                            <!-- Les √©tudiants seront charg√©s dynamiquement ici -->
                        </div>
                        
                        <div class="pagination" id="pagination-container">
                            <!-- La pagination sera g√©n√©r√©e dynamiquement -->
                        </div>
                    </div>
                </div>
                
                <!-- Right Column - Student Profile -->
                <div class="right-column">
                    <div class="student-profile">
                        <div class="card" id="student-profile-card">
                            <!-- Le profil de l'√©tudiant sera charg√© dynamiquement ici -->
                            <div class="empty-profile">
                                <p>S√©lectionnez un √©tudiant pour voir son profil</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", async function () {
        // Load navigation
        fetch("enseignant-nav.html")
            .then((response) => response.text())
            .then((html) => {
            document.getElementById("navbar-container").innerHTML = html;
            // Mark active link after loading
            const navScript = document.createElement("script");
            navScript.innerHTML = `
                document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if(link.getAttribute('href') === '${window.location.pathname.split("/").pop()}') {
                    link.classList.add('active');
                }
                });
            `;
            document.body.appendChild(navScript);
            })
            .catch((error) => {
            console.error("Error loading navigation:", error);
            });
        currentUser = {
            id: "demo-teacher",
            email: "demo@univ.edu"
        };

        try {
            await loadUserData();
            await loadDashboardData();
        } catch (error) {
            console.error("Error loading data:", error);
            loadFallbackData();
        }
        });

        // Donn√©es simul√©es
        const mockStudents = [];
        const firstNames = ["Ahmed", "Fatima", "Karim", "Lina", "Yacine", "Sara", "Mohamed", "Amina", "Nassim", "Leila"];
        const lastNames = ["Saidi", "Benali", "Hadj", "Mansouri", "Boudiaf", "Messaoudi", "Benzema", "Cherif", "Zitouni", "Kadri"];
        const sections = ["info-a", "info-b", "math-c"];
        const modules = ["Algo", "Alg√®bre", "Prog", "Analyse", "Archi"];
        
        // G√©n√©rer 50 √©tudiants al√©atoires
        for (let i = 0; i < 50; i++) {
            const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
            const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
            const section = sections[Math.floor(Math.random() * sections.length)];
            
            // G√©n√©rer des taux de pr√©sence al√©atoires pour chaque module
            const attendance = {};
            modules.forEach(module => {
                attendance[module] = Math.floor(Math.random() * 20 + 80); // Entre 80% et 100%
            });
            
            // Calculer la pr√©sence globale moyenne
            const globalAttendance = Math.round(Object.values(attendance).reduce((a, b) => a + b, 0) / modules.length);
            
            mockStudents.push({
                id: `2023${Math.floor(10000 + Math.random() * 90000)}`,
                firstName: firstName,
                lastName: lastName,
                email: `${firstName.toLowerCase()}.${lastName.toLowerCase()}@etudiant.university.dz`,
                phone: `+213 ${Math.floor(500 + Math.random() * 100)} ${Math.floor(100 + Math.random() * 900)} ${Math.floor(100 + Math.random() * 900)}`,
                section: section,
                enrollmentYear: 2023,
                globalAttendance: globalAttendance,
                attendance: attendance,
                tdGroup: `TD${Math.floor(Math.random() * 3 + 1)}`,
                tpGroup: `TP${Math.floor(Math.random() * 3 + 1)}`
            });
        }
        
        // Variables d'√©tat
        let currentPage = 1;
        const studentsPerPage = 6;
        let filteredStudents = [...mockStudents];
        let selectedStudent = null;
        
        // Fonction pour afficher les √©tudiants
        function displayStudents() {
            const container = document.getElementById('student-list-container');
            container.innerHTML = '';
            
            const startIndex = (currentPage - 1) * studentsPerPage;
            const endIndex = startIndex + studentsPerPage;
            const studentsToShow = filteredStudents.slice(startIndex, endIndex);
            
            studentsToShow.forEach(student => {
                const studentElement = document.createElement('div');
                studentElement.className = `student-item ${selectedStudent && selectedStudent.id === student.id ? 'selected' : ''}`;
                studentElement.onclick = () => selectStudent(student);
                
                const initials = `${student.firstName.charAt(0)}${student.lastName.charAt(0)}`;
                
                studentElement.innerHTML = `
                    <div class="student-avatar">${initials}</div>
                    <div class="student-info">
                        <div class="student-name">${student.firstName} ${student.lastName}</div>
                        <div class="student-id">ID: ${student.id}</div>
                    </div>
                `;
                
                container.appendChild(studentElement);
            });
            
            updatePagination();
            
            // Si aucun √©tudiant n'est s√©lectionn√© mais qu'il y a des √©tudiants, s√©lectionner le premier
            if (!selectedStudent && studentsToShow.length > 0) {
                selectStudent(studentsToShow[0]);
            }
        }
        
        // Fonction pour mettre √† jour la pagination
        function updatePagination() {
            const totalPages = Math.ceil(filteredStudents.length / studentsPerPage);
            const container = document.getElementById('pagination-container');
            container.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            // Bouton pr√©c√©dent
            if (currentPage > 1) {
                const prevBtn = document.createElement('button');
                prevBtn.className = 'pagination-btn';
                prevBtn.innerHTML = '<';
                prevBtn.onclick = () => {
                    currentPage--;
                    displayStudents();
                };
                container.appendChild(prevBtn);
            }
            
            // Boutons de page
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.onclick = () => {
                    currentPage = i;
                    displayStudents();
                };
                container.appendChild(pageBtn);
            }
            
            // Bouton suivant
            if (currentPage < totalPages) {
                const nextBtn = document.createElement('button');
                nextBtn.className = 'pagination-btn';
                nextBtn.innerHTML = '>';
                nextBtn.onclick = () => {
                    currentPage++;
                    displayStudents();
                };
                container.appendChild(nextBtn);
            }
        }
        
        // Fonction pour filtrer les √©tudiants
        function filterStudents() {
            const searchTerm = document.getElementById('student-search').value.toLowerCase();
            const sectionFilter = document.getElementById('section-filter').value;
            
            filteredStudents = mockStudents.filter(student => {
                const fullName = `${student.firstName} ${student.lastName}`.toLowerCase();
                const matchesSearch = fullName.includes(searchTerm) || student.id.includes(searchTerm);
                const matchesSection = sectionFilter ? student.section === sectionFilter : true;
                
                return matchesSearch && matchesSection;
            });
            
            currentPage = 1;
            displayStudents();
        }
        
        // Fonction pour s√©lectionner un √©tudiant
        function selectStudent(student) {
            selectedStudent = student;
            displayStudents();
            displayStudentProfile(student);
        }
        
        // Fonction pour afficher le profil de l'√©tudiant
        function displayStudentProfile(student) {
            const container = document.getElementById('student-profile-card');
            const initials = `${student.firstName.charAt(0)}${student.lastName.charAt(0)}`;
            
            // Section name mapping
            const sectionNames = {
                "info-a": "Informatique - Section A",
                "info-b": "Informatique - Section B",
                "math-c": "Math√©matiques - Section C"
            };
            
            // Cr√©er les barres du graphique de pr√©sence
            const attendanceBars = modules.map(module => {
                const height = student.attendance[module];
                return `<div class="chart-bar" style="height: ${height}%;" data-label="${height}%"></div>`;
            }).join('');
            
            // Cr√©er les labels du graphique
            const attendanceLabels = modules.map(module => {
                return `<div class="chart-label">${module}</div>`;
            }).join('');
            
            container.innerHTML = `
                <div class="profile-header">
                    <div class="profile-avatar">${initials}</div>
                    <div>
                        <div class="profile-name">${student.firstName} ${student.lastName}</div>
                        <div class="student-id">ID: ${student.id} | ${sectionNames[student.section]}</div>
                    </div>
                </div>
                
                <div class="profile-details">
                    <div>
                        <div class="detail-group">
                            <div class="detail-label">Email</div>
                            <div class="detail-value">${student.email}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">T√©l√©phone</div>
                            <div class="detail-value">${student.phone}</div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="detail-group">
                            <div class="detail-label">Ann√©e d'Inscription</div>
                            <div class="detail-value">${student.enrollmentYear}</div>
                        </div>
                        
                        <div class="detail-group">
                            <div class="detail-label">Pr√©sence Globale</div>
                            <div class="detail-value">${student.globalAttendance}%</div>
                        </div>
                    </div>
                </div>
                
                <div class="group-management">
                    <h3 class="detail-label">Modification des Groupes</h3>
                    
                    <div class="group-selector">
                        <select id="td-group-select">
                            <option value="TD1" ${student.tdGroup === 'TD1' ? 'selected' : ''}>TD1</option>
                            <option value="TD2" ${student.tdGroup === 'TD2' ? 'selected' : ''}>TD2</option>
                            <option value="TD3" ${student.tdGroup === 'TD3' ? 'selected' : ''}>TD3</option>
                        </select>
                        
                        <select id="tp-group-select">
                            <option value="TP1" ${student.tpGroup === 'TP1' ? 'selected' : ''}>TP1</option>
                            <option value="TP2" ${student.tpGroup === 'TP2' ? 'selected' : ''}>TP2</option>
                            <option value="TP3" ${student.tpGroup === 'TP3' ? 'selected' : ''}>TP3</option>
                        </select>
                        
                        <button onclick="updateStudentGroups()">Modifier</button>
                    </div>
                </div>
                
                <div class="attendance-summary">
                    <h3 class="detail-label">Assiduit√© par Module</h3>
                    
                    <div class="attendance-chart">
                        ${attendanceBars}
                    </div>
                    
                    <div style="display: flex; justify-content: space-between;">
                        ${attendanceLabels}
                    </div>
                </div>
            `;
        }
        
        // Fonction pour mettre √† jour les groupes d'un √©tudiant
        function updateStudentGroups() {
            if (!selectedStudent) return;
            
            const tdGroupSelect = document.getElementById('td-group-select');
            const tpGroupSelect = document.getElementById('tp-group-select');
            
            selectedStudent.tdGroup = tdGroupSelect.value;
            selectedStudent.tpGroup = tpGroupSelect.value;
            
            // Mettre √† jour l'affichage
            displayStudentProfile(selectedStudent);
            displayStudents();
            
            alert("Groupes mis √† jour avec succ√®s!");
        }
        
        // Initialisation
        document.addEventListener("DOMContentLoaded", function() {
            // Simuler le chargement de la navbar
            document.getElementById('navbar-container').innerHTML = `
                <div style="padding: 20px;">
                    <h2>Menu Enseignant</h2>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin-bottom: 10px;"><a href="#" style="color: white; text-decoration: none;">Dashboard</a></li>
                        <li style="margin-bottom: 10px;"><a href="#" style="color: white; text-decoration: none;">Cours</a></li>
                        <li style="margin-bottom: 10px;"><a href="#" style="color: #3498db; text-decoration: none;">√âtudiants</a></li>
                        <li style="margin-bottom: 10px;"><a href="#" style="color: white; text-decoration: none;">Notes</a></li>
                        <li style="margin-bottom: 10px;"><a href="#" style="color: white; text-decoration: none;">Param√®tres</a></li>
                    </ul>
                </div>
            `;
            
            // Afficher les √©tudiants au chargement
            displayStudents();
            
            // Gestion de la recherche lors de la frappe
            document.getElementById('student-search').addEventListener('keyup', function(e) {
                if (e.key === 'Enter') {
                    filterStudents();
                }
            });
        });
    </script>
</body>
</html>
